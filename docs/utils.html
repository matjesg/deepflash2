---

title: Utility functions


keywords: fastai
sidebar: home_sidebar

summary: "Utility functions for deepflash2"
description: "Utility functions for deepflash2"
nb_path: "nbs/06_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/06_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Archive-Extraction">Archive Extraction<a class="anchor-link" href="#Archive-Extraction"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="unzip" class="doc_header"><code>unzip</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L28" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>unzip</code>(<strong><code>path</code></strong>, <strong><code>zip_file</code></strong>)</p>
</blockquote>
<p>Unzip and structure archive</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install-packages-on-demand">Install packages on demand<a class="anchor-link" href="#Install-packages-on-demand"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="install_package" class="doc_header"><code>install_package</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L41" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>install_package</code>(<strong><code>package</code></strong>, <strong><code>version</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="import_package" class="doc_header"><code>import_package</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L48" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>import_package</code>(<strong><code>package</code></strong>, <strong><code>version</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compose_albumentations" class="doc_header"><code>compose_albumentations</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L59" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compose_albumentations</code>(<strong><code>gamma_limit_lower</code></strong>=<em><code>0</code></em>, <strong><code>gamma_limit_upper</code></strong>=<em><code>0</code></em>, <strong><code>CLAHE_clip_limit</code></strong>=<em><code>0.0</code></em>, <strong><code>brightness_limit</code></strong>=<em><code>0</code></em>, <strong><code>contrast_limit</code></strong>=<em><code>0.0</code></em>, <strong><code>distort_limit</code></strong>=<em><code>0.0</code></em>)</p>
</blockquote>
<p>Compose albumentations augmentations</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Ensembling">Ensembling<a class="anchor-link" href="#Ensembling"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="ensemble_results" class="doc_header"><code>ensemble_results</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L73" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>ensemble_results</code>(<strong><code>res_dict</code></strong>, <strong><code>file</code></strong>, <strong><code>std</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Combines single model predictions.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_results" class="doc_header"><code>plot_results</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L85" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_results</code>(<strong>*<code>args</code></strong>, <strong><code>df</code></strong>, <strong><code>hastarget</code></strong>=<em><code>False</code></em>, <strong><code>model</code></strong>=<em><code>None</code></em>, <strong><code>metric_name</code></strong>=<em><code>'dice_score'</code></em>, <strong><code>unc_metric</code></strong>=<em><code>None</code></em>, <strong><code>figsize</code></strong>=<em><code>(20, 20)</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Plot images, (masks), predictions and uncertainties side-by-side.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Patch-to-show-metrics-in-Learner">Patch to show metrics in Learner<a class="anchor-link" href="#Patch-to-show-metrics-in-Learner"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Recorder.plot_metrics" class="doc_header"><code>Recorder.plot_metrics</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L137" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Recorder.plot_metrics</code>(<strong><code>nrows</code></strong>=<em><code>None</code></em>, <strong><code>ncols</code></strong>=<em><code>None</code></em>, <strong><code>figsize</code></strong>=<em><code>None</code></em>, <strong><code>sharex</code></strong>=<em><code>False</code></em>, <strong><code>sharey</code></strong>=<em><code>False</code></em>, <strong><code>squeeze</code></strong>=<em><code>True</code></em>, <strong><code>subplot_kw</code></strong>=<em><code>None</code></em>, <strong><code>gridspec_kw</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Pixelwise-Analysis">Pixelwise Analysis<a class="anchor-link" href="#Pixelwise-Analysis"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="iou" class="doc_header"><code>iou</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L158" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>iou</code>(<strong><code>a</code></strong>, <strong><code>b</code></strong>, <strong><code>threshold</code></strong>=<em><code>0.5</code></em>, <strong><code>average</code></strong>=<em><code>'macro'</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Computes the Intersection-Over-Union metric.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">iou</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">iou</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">empty_mask</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Todo: add multiclass tests https://scikit-learn.org/stable/modules/generated/sklearn.metrics.jaccard_score.html</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dice_score" class="doc_header"><code>dice_score</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L172" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dice_score</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Computes the Dice coefficient metric.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">dice_score</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">dice_score</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">empty_mask</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ROI-wise-Analysis">ROI-wise Analysis<a class="anchor-link" href="#ROI-wise-Analysis"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="label_mask" class="doc_header"><code>label_mask</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L178" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>label_mask</code>(<strong><code>mask</code></strong>, <strong><code>threshold</code></strong>=<em><code>0.5</code></em>, <strong><code>connectivity</code></strong>=<em><code>4</code></em>, <strong><code>min_pixel</code></strong>=<em><code>0</code></em>, <strong><code>do_watershed</code></strong>=<em><code>False</code></em>, <strong><code>exclude_border</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Analyze regions and return labels</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst_lbl_a</span> <span class="o">=</span> <span class="n">label_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">min_pixel</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tst_lbl_a</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tst_lbl_a</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tst_lbl_a</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tst_lbl_b</span> <span class="o">=</span> <span class="n">label_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">min_pixel</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tst_lbl_b</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tst_lbl_b</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_instance_segmentation_metrics" class="doc_header"><code>get_instance_segmentation_metrics</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L217" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_instance_segmentation_metrics</code>(<strong><code>a</code></strong>, <strong><code>b</code></strong>, <strong><code>is_binary</code></strong>=<em><code>False</code></em>, <strong><code>thresholds</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Computes instance segmentation metric based on cellpose/stardist implementation.
<a href="https://cellpose.readthedocs.io/en/latest/api.html#cellpose.metrics.average_precision">https://cellpose.readthedocs.io/en/latest/api.html#cellpose.metrics.average_precision</a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ap</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">get_instance_segmentation_metrics</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ap</span><span class="p">),</span><span class="mi">10</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ap</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span> <span class="o">=</span> <span class="n">get_instance_segmentation_metrics</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">empty_mask</span><span class="p">,</span> <span class="n">is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">thresholds</span><span class="o">=</span><span class="p">[</span><span class="mf">.5</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ap</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">fn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2021-10-30 16:14:03,087 [INFO] WRITING LOG OUTPUT TO /media/data/home/mag01ud/.cellpose/run.log
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="ROI-Export-to-ImageJ">ROI Export to ImageJ<a class="anchor-link" href="#ROI-Export-to-ImageJ"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="export_roi_set" class="doc_header"><code>export_roi_set</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L242" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>export_roi_set</code>(<strong><code>mask</code></strong>, <strong><code>intensity_image</code></strong>=<em><code>None</code></em>, <strong><code>instance_labels</code></strong>=<em><code>False</code></em>, <strong><code>name</code></strong>=<em><code>'RoiSet'</code></em>, <strong><code>path</code></strong>=<em><code>Path('.')</code></em>, <strong><code>ascending</code></strong>=<em><code>True</code></em>, <strong><code>min_pixel</code></strong>=<em><code>0</code></em>)</p>
</blockquote>
<p>EXPERIMENTAL: Export mask regions to imageJ ROI Set</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">export_roi_set</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Miscellaneous">Miscellaneous<a class="anchor-link" href="#Miscellaneous"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_iterations" class="doc_header"><code>calc_iterations</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L272" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_iterations</code>(<strong><code>n_iter</code></strong>, <strong><code>ds_length</code></strong>, <strong><code>bs</code></strong>)</p>
</blockquote>
<p>Calculate the number of required epochs for 'n_iter' iterations.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">calc_iterations</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_label_fn" class="doc_header"><code>get_label_fn</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L278" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_label_fn</code>(<strong><code>img_path</code></strong>, <strong><code>msk_dir_path</code></strong>)</p>
</blockquote>
<p>Infers suffix from mask name and return label_fn</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_mask" class="doc_header"><code>save_mask</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L285" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_mask</code>(<strong><code>mask</code></strong>, <strong><code>path</code></strong>, <strong><code>filetype</code></strong>=<em><code>'.png'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">save_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;.png&#39;</span><span class="p">):</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="k">else</span> <span class="p">(</span><span class="n">mask</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">imageio</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="n">filetype</span><span class="p">),</span> <span class="n">mask</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_unc" class="doc_header"><code>save_unc</code><a href="https://github.com/matjesg/deepflash2/tree/master/deepflash2/utils.py#L290" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_unc</code>(<strong><code>unc</code></strong>, <strong><code>path</code></strong>, <strong><code>filetype</code></strong>=<em><code>'.png'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">save_unc</span><span class="p">(</span><span class="n">unc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s1">&#39;.png&#39;</span><span class="p">):</span>
    <span class="n">unc</span> <span class="o">=</span> <span class="p">(</span><span class="n">unc</span><span class="o">/</span><span class="n">unc</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">imageio</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="n">filetype</span><span class="p">),</span> <span class="n">unc</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

